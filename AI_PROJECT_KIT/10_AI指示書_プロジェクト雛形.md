# AI指示書（プロジェクト雛形）

この文書は、AI（Cursor Agent / Copilot Coding Agent 等）がこのプロジェクトで作業する際の**最上位ルール**です。

## 0. このプロジェクトの概要（ここを埋める）

- **プロダクト/目的**：<ここに記入>
- **主要技術**：<例: Next.js / Unity / Python>
- **重要な制約**：<例: 既存互換性、納期、パフォーマンス、セキュリティ>

## 1. 絶対ルール（破ったらNG）

- **mainへ直接コミット禁止**：必ずブランチ→PR。
- **変更は小さく分割**：1PR=1目的。
- **検証必須**：変更後に `lint` / `typecheck` / `test` を実行し、失敗したら原因→修正→再実行。
- **秘密情報を出力しない/要求しない**：APIキー、個人情報、社外秘仕様など。
- **破壊的操作は禁止**：削除、DB破壊、権限変更、本番反映は“提案のみ”。


## 2. コーディング規約（ここを埋める）

- **命名**：<例: camelCase / PascalCase / snake_case>
- **ディレクトリ規約**：<例: src/ 配下のみ編集、components/ の構造>
- **例外/エラー方針**：<例: 例外を投げる/Result型、エラーコード設計>
- **ログ方針**：<例: 個人情報はログに出さない>
- **依存関係追加**：<例: 追加前に理由と代替案を提示>

## 2-A. C# / Unity 固有規則（該当プロジェクトのみ）

> 詳細は `170_Unity_CSharp設計規則.md` を参照

### 設計原則：Pure C#設計

- **MonoBehaviour**：Unityとの接点のみ（入力/物理/ライフサイクル/UI）
- **Pure C#**：ビジネスロジック、スキル、ステート管理（AIが書く）
- **ScriptableObject**：設定データ（ステータス、パラメータ）

### フォルダ構成

```
Assets/Scripts/
├── MonoBehaviours/   # MonoBehaviourはここだけ（少数）
├── PureCS/           # Pure C#クラス（大量）← AIが書く
├── ScriptableObjects/# 設定データ
└── Common/           # ユーティリティ
```

### ルール

- **MonoBehaviourにロジックを書かない**：Pure C#に委譲
- **インターフェースで責務を明確化**：人間が設計、AIが実装
- **依存は外から渡す（DI）**：コンストラクタ or メソッド引数

### AIへの指示時

- インターフェース/責務を明確に伝える
- 参考となる既存クラスを指定
- 配置先（フォルダ/ファイル名）を指定

## 3. 実行コマンド（ここを埋める）

- **インストール**：<例: npm ci>
- **lint**：<例: npm run lint>
- **typecheck**：<例: npm run typecheck>
- **test**：<例: npm test>
- **dev起動**：<例: npm run dev>

## 4. Git運用（コミット/PR/PUSH）

### コミットメッセージ規則（Conventional Commits）

```
<type>(<scope>): <subject>

type:
  feat     : 新機能
  fix      : バグ修正
  docs     : ドキュメント
  refactor : リファクタ（機能変更なし）
  test     : テスト追加/修正
  chore    : ビルド/設定変更

例:
  feat(auth): ログイン機能追加
  fix(api): nullチェック漏れ修正
  docs(readme): セットアップ手順追記
```

### PRの粒度

- **1PR=1目的**（機能追加/バグ修正/リファクタ等を混ぜない）
- **差分300行以下**を目安（超えたら分割を検討）
- **コミットは論理的な1ステップ=1コミット**

### PUSH前チェック

- 必ず `lint` / `typecheck` / `test` を通す
- 通らない状態でPUSHしない

### PR本文

- `AI_PROJECT_KIT/40_PRテンプレ.md` の形式に合わせる
- 変更点には必ず以下を含める
  - 目的（なぜ）
  - 変更概要（何を）
  - テスト（どう確認したか）
  - リスク/ロールバック（壊れたらどう戻すか）

## 5. よく参照すべきファイル（ここを埋める）

- 設計/仕様：<path>
- 代表実装：<path>
- UI/コンポーネント指針：<path>
- API規約：<path>

## 6. 作業の進め方（AIの標準手順）★重要★

### 原則：「計画承認なしに実装しない」

1. **調査**：現状を把握し、影響範囲を洗い出す
2. **計画提示**：実装案を**2〜3案**出し、各案のメリット/デメリット/リスクを比較
3. **ユーザー承認**：ユーザーが案を選択または修正指示を出すまで待つ
4. **実装**：承認された案に沿って、小刻みに実装→検証
5. **PR作成**：検証が通ったらPR要約を出す
6. **振り返り**：学びをルールに反映

### 計画提示のフォーマット

```
## 案A：<タイトル>
- 概要：
- 変更ファイル：
- メリット：
- デメリット：
- リスク：
- 見積もり：大/中/小

## 案B：<タイトル>
...

## 推奨案と理由
```

### 禁止

- ユーザー承認なしに実装を始めること
- 1案だけ出して「これでいいですか？」と聞くこと（最低2案）

